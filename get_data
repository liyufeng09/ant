#include <stdio.h>
#include <ctype.h>
#include <string.h>
#include "greedy.h"

int get_data(int data[][REQ_COUNT])
{
    int n=1;
    FILE *fp=NULL;
    memset(data,0,CITY_COUNT*REQ_COUNT*sizeof(data));
    char *buffer=(char *)malloc(BUF_SIZE*sizeof(char));
    memset(buffer,'\0',1024*sizeof(char));
    char * file_name=(char *)malloc(FILE_NAME*sizeof(char));
    int k;

    while(n<10)
    {
        memset(file_name,'\0',FILE_NAME);
        sprintf(file_name,"../../Documents/Graduate/siemens2/printtokens/outputs/t%d.c.gcov",n);
        fp=fopen(file_name,"r");//Open file
        if(fp==NULL)
        {
            printf("failed to open file:%s.\n",file_name);
            return -1;
        }
        k=1;
        while(fgets(buffer,1024,fp))//read lines
        {
            int i=0,j=0;
            char num[10];
            memset(num,'\0',10*sizeof(char));
            while(buffer[i])
            {
                if(buffer[i]>='0'&&buffer[i]<='9')
                {
                    num[j]=buffer[i];
                    i++;
                    j++;
                }
                else if(buffer[i]==':')
                {
                    data[n][k]=atoi(num);
                    k++;
                    break;
                }
                else if(buffer[i]=='#')
                {
                    data[n][k]=0;
                    k++;
                    break;
                }
                else if(buffer[i]=='-')
                {
                    break;
                }
                else
                {
                    i++;
                }
            }
        }
        data[n][0]=k;//record lenth of data

        if(fclose(fp)!=0)//close file
        {
            printf("%s close failed.\n",file_name);
        }
        for(int i=0; i<data[n][0]; i++)
        {
            printf("%d ",data[n][i]);
        }
        printf("\n");
        n++;
    }
    return k;
    free(buffer);
    free(file_name);
    return 0;
}
